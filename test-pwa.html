<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste PWA - Yamar Project</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }

    .test-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .test-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .test-icon {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }

    .status {
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }

    .status.pass { background: #d4edda; color: #155724; }
    .status.fail { background: #f8d7da; color: #721c24; }
    .status.warn { background: #fff3cd; color: #856404; }
    .status.info { background: #d1ecf1; color: #0c5460; }

    .test-result {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }

    .btn {
      background: #c9a227;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }

    .btn:hover { background: #b8941f; }

    .btn.secondary { background: #6c757d; }
    .btn.secondary:hover { background: #545b62; }

    .hidden { display: none; }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: #c9a227;
      width: 0%;
      transition: width 0.3s ease;
    }

    .summary {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin-top: 20px;
    }

    .summary h3 {
      margin-top: 0;
      color: #c9a227;
    }
  </style>
</head>
<body>
  <h1>üß™ Teste PWA - Yamar Project</h1>
  <p>Esta p√°gina testa todas as funcionalidades da Progressive Web App.</p>

  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>

  <div id="testResults"></div>

  <div class="summary hidden" id="summary">
    <h3>üìä Resumo dos Testes</h3>
    <p id="summaryText"></p>
    <button class="btn" onclick="runAllTests()">üîÑ Executar Todos os Testes</button>
    <button class="btn secondary" onclick="clearResults()">üóëÔ∏è Limpar Resultados</button>
  </div>

  <script>
    let testResults = [];
    let completedTests = 0;
    const totalTests = 12;

    // Test functions
    async function testHTTPS() {
      const isHTTPS = location.protocol === 'https:' || location.hostname === 'localhost';
      return {
        name: 'HTTPS',
        status: isHTTPS ? 'pass' : 'fail',
        message: isHTTPS ? 'Site est√° usando HTTPS' : 'Site deve usar HTTPS para PWA'
      };
    }

    async function testManifest() {
      try {
        const response = await fetch('/manifest.json');
        if (!response.ok) throw new Error('Manifest n√£o encontrado');

        const manifest = await response.json();
        const required = ['name', 'short_name', 'start_url', 'display', 'icons'];
        const hasRequired = required.every(key => manifest.hasOwnProperty(key));

        return {
          name: 'Manifest.json',
          status: hasRequired ? 'pass' : 'fail',
          message: hasRequired ? 'Manifest v√°lido com campos obrigat√≥rios' : 'Manifest faltando campos obrigat√≥rios'
        };
      } catch (error) {
        return {
          name: 'Manifest.json',
          status: 'fail',
          message: 'Erro ao carregar manifest: ' + error.message
        };
      }
    }

    async function testServiceWorker() {
      if (!('serviceWorker' in navigator)) {
        return {
          name: 'Service Worker',
          status: 'fail',
          message: 'Service Worker n√£o suportado neste navegador'
        };
      }

      try {
        const registration = await navigator.serviceWorker.getRegistration();
        return {
          name: 'Service Worker',
          status: registration ? 'pass' : 'fail',
          message: registration ? 'Service Worker registrado' : 'Service Worker n√£o registrado'
        };
      } catch (error) {
        return {
          name: 'Service Worker',
          status: 'fail',
          message: 'Erro no Service Worker: ' + error.message
        };
      }
    }

    async function testIcons() {
      const iconSizes = [72, 96, 128, 144, 152, 192, 384, 512];
      let loadedIcons = 0;

      for (const size of iconSizes) {
        try {
          const response = await fetch(`/assets/images/icon-${size}.png`);
          if (response.ok) loadedIcons++;
        } catch (error) {
          // Continue checking other icons
        }
      }

      const status = loadedIcons === iconSizes.length ? 'pass' : loadedIcons > 0 ? 'warn' : 'fail';
      return {
        name: '√çcones PWA',
        status: status,
        message: `${loadedIcons}/${iconSizes.length} √≠cones carregados`
      };
    }

    async function testScreenshots() {
      let loadedScreenshots = 0;
      const screenshots = ['mobile', 'desktop'];

      for (const type of screenshots) {
        try {
          const response = await fetch(`/assets/images/screenshot-${type}.png`);
          if (response.ok) loadedScreenshots++;
        } catch (error) {
          // Continue checking
        }
      }

      return {
        name: 'Screenshots',
        status: loadedScreenshots === screenshots.length ? 'pass' : 'warn',
        message: `${loadedScreenshots}/${screenshots.length} screenshots dispon√≠veis`
      };
    }

    async function testInstallScript() {
      try {
        const response = await fetch('/js/pwa-install.js');
        return {
          name: 'Script de Instala√ß√£o',
          status: response.ok ? 'pass' : 'fail',
          message: response.ok ? 'Script pwa-install.js carregado' : 'Script n√£o encontrado'
        };
      } catch (error) {
        return {
          name: 'Script de Instala√ß√£o',
          status: 'fail',
          message: 'Erro ao carregar script: ' + error.message
        };
      }
    }

    async function testResponsive() {
      const viewport = document.querySelector('meta[name="viewport"]');
      const hasViewport = viewport && viewport.content.includes('width=device-width');

      return {
        name: 'Responsividade',
        status: hasViewport ? 'pass' : 'fail',
        message: hasViewport ? 'Meta viewport configurado' : 'Meta viewport faltando'
      };
    }

    async function testThemeColor() {
      const themeColor = document.querySelector('meta[name="theme-color"]');
      return {
        name: 'Theme Color',
        status: themeColor ? 'pass' : 'fail',
        message: themeColor ? 'Theme color definido' : 'Theme color n√£o definido'
      };
    }

    async function testAppleMetaTags() {
      const appleCapable = document.querySelector('meta[name="apple-mobile-web-app-capable"]');
      const appleTitle = document.querySelector('meta[name="apple-mobile-web-app-title"]');

      const hasApple = appleCapable && appleTitle;
      return {
        name: 'Meta Tags iOS',
        status: hasApple ? 'pass' : 'warn',
        message: hasApple ? 'Meta tags iOS configuradas' : 'Meta tags iOS opcionais n√£o encontradas'
      };
    }

    async function testCacheAPI() {
      if (!('caches' in window)) {
        return {
          name: 'Cache API',
          status: 'fail',
          message: 'Cache API n√£o suportado'
        };
      }

      try {
        const cacheNames = await caches.keys();
        return {
          name: 'Cache API',
          status: 'pass',
          message: `${cacheNames.length} caches ativos`
        };
      } catch (error) {
        return {
          name: 'Cache API',
          status: 'fail',
          message: 'Erro na Cache API: ' + error.message
        };
      }
    }

    async function testOfflineCapability() {
      // Simple offline test - check if we can load a cached resource
      try {
        const response = await fetch('/css/styles.css', { cache: 'only-if-cached' });
        return {
          name: 'Capacidade Offline',
          status: response ? 'pass' : 'info',
          message: response ? 'Recursos em cache dispon√≠veis' : 'Teste offline limitado'
        };
      } catch (error) {
        return {
          name: 'Capacidade Offline',
          status: 'info',
          message: 'Recursos podem funcionar offline'
        };
      }
    }

    async function testPWAInstall() {
      const isInstallable = 'onbeforeinstallprompt' in window || window.matchMedia('(display-mode: standalone)').matches;
      return {
        name: 'Instalabilidade PWA',
        status: isInstallable ? 'pass' : 'info',
        message: isInstallable ? 'PWA instal√°vel neste dispositivo' : 'PWA pode n√£o ser instal√°vel'
      };
    }

    // UI functions
    function createTestElement(test) {
      return `
        <div class="test-section">
          <div class="test-header">
            <span class="test-icon">${getIcon(test.name)}</span>
            <h3>${test.name}</h3>
            <span class="status ${test.status}">${test.status.toUpperCase()}</span>
          </div>
          <div class="test-result">${test.message}</div>
        </div>
      `;
    }

    function getIcon(testName) {
      const icons = {
        'HTTPS': 'üîí',
        'Manifest.json': 'üìÑ',
        'Service Worker': '‚öôÔ∏è',
        '√çcones PWA': 'üñºÔ∏è',
        'Screenshots': 'üì∏',
        'Script de Instala√ß√£o': 'üìú',
        'Responsividade': 'üì±',
        'Theme Color': 'üé®',
        'Meta Tags iOS': 'üçé',
        'Cache API': 'üíæ',
        'Capacidade Offline': 'üì¥',
        'Instalabilidade PWA': '‚¨áÔ∏è'
      };
      return icons[testName] || '‚úÖ';
    }

    function updateProgress() {
      const progress = (completedTests / totalTests) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    function showSummary() {
      const passed = testResults.filter(t => t.status === 'pass').length;
      const failed = testResults.filter(t => t.status === 'fail').length;
      const warnings = testResults.filter(t => t.status === 'warn').length;

      const summaryText = `
        <strong>${passed}</strong> testes passaram,
        <strong>${failed}</strong> falharam,
        <strong>${warnings}</strong> avisos.
        ${failed === 0 ? 'üéâ PWA pronta para produ√ß√£o!' : '‚ö†Ô∏è Corrigir falhas antes do deploy.'}
      `;

      document.getElementById('summaryText').innerHTML = summaryText;
      document.getElementById('summary').classList.remove('hidden');
    }

    async function runTest(testFunction) {
      try {
        const result = await testFunction();
        testResults.push(result);
        document.getElementById('testResults').innerHTML += createTestElement(result);
        completedTests++;
        updateProgress();

        if (completedTests === totalTests) {
          showSummary();
        }
      } catch (error) {
        console.error('Erro no teste:', error);
      }
    }

    async function runAllTests() {
      testResults = [];
      completedTests = 0;
      document.getElementById('testResults').innerHTML = '';
      document.getElementById('summary').classList.add('hidden');
      updateProgress();

      const tests = [
        testHTTPS,
        testManifest,
        testServiceWorker,
        testIcons,
        testScreenshots,
        testInstallScript,
        testResponsive,
        testThemeColor,
        testAppleMetaTags,
        testCacheAPI,
        testOfflineCapability,
        testPWAInstall
      ];

      for (const test of tests) {
        await runTest(test);
        // Small delay between tests for better UX
        await new Promise(resolve => setTimeout(resolve, 200));
      }
    }

    function clearResults() {
      testResults = [];
      completedTests = 0;
      document.getElementById('testResults').innerHTML = '';
      document.getElementById('summary').classList.add('hidden');
      document.getElementById('progressFill').style.width = '0%';
    }

    // Auto-run tests on page load
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 500);
    });
  </script>
</body>
</html>